<VirtualHost *:80>
    ServerName nexobot.dotsky.com.br
    ServerAdmin cehd.oliveira@gmail.com
    
    DocumentRoot /var/www/nexobot/site/public_html

    # Propagação do protocolo HTTPS do reverse proxy (Traefik)
    # Sem isso, PHP não detecta HTTPS e gera URLs http://, quebrando cookies Secure
    SetEnvIf X-Forwarded-Proto "^https$" HTTPS=on
    RequestHeader set X-Forwarded-Proto "https" env=HTTPS

    <Directory /var/www/nexobot/site/public_html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Proteção contra acesso direto
        <FilesMatch "\.(ini|log|sh|sql)$">
            Require all denied
        </FilesMatch>
    </Directory>
    
    # Logs
    ErrorLog /var/log/apache2/site_error.log
    CustomLog /var/log/apache2/site_access.log combined
    
    # PHP Settings
    php_value upload_max_filesize 50M
    php_value post_max_size 50M
    php_value memory_limit 256M
    php_value max_execution_time 300
</VirtualHost>
