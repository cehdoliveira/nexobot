<?php

/**
 * Kernel - Arquivo de Configuração Global
 * PHP 8.3+ | MySQL 8.0 | Redis 7.2
 *
 * Este arquivo contém as configurações sensíveis da aplicação.
 * NÃO VERSIONAR ESTE ARQUIVO NO GIT (incluído no .gitignore).
 *
 * @package Nexo
 * @version 1.0.0
 */

// ============================================================================
// BOOTSTRAP DO PHP
// ============================================================================

/**
 * Timezone padrão da aplicação
 */
date_default_timezone_set("America/Sao_Paulo");

/**
 * Configurações globais de encoding e upload
 */
ini_set("default_charset", "UTF-8");
ini_set("post_max_size", "4096M");
ini_set("upload_max_filesize", "4096M");

// ============================================================================
// CONSTANTES GLOBAIS DA APLICAÇÃO
// ============================================================================

/**
 * Ex: Paginação padrão para listagens
 */
define("cPaginate", 150);

// ============================================================================
// CONFIGURAÇÕES DO BANCO DE DADOS (MySQL)
// ============================================================================

/**
 * Host do servidor MySQL
 * Docker: nome do container
 * Produção: localhost ou IP do servidor
 */
define("DB_HOST", "<IP_OU_HOST_DO_SERVIDOR>");

/**
 * Nome do banco de dados
 */
define("DB_NAME", "<NOME_DO_BANCO>");

/**
 * Usuário do banco
 */
define("DB_USER", "<USUARIO_DO_BANCO>");

/**
 * Senha do banco
 */
define("DB_PASS", "<SENHA_DO_BANCO>");

// ============================================================================
// CONFIGURAÇÕES DO REDIS
// ============================================================================

/**
 * Host do Redis
 */
define("REDIS_HOST", "redis");

/**
 * Porta padrão do Redis
 */
define("REDIS_PORT", 6379);

/**
 * Prefixo de namespace das chaves Redis
 */
define("REDIS_PREFIX", "<NOME_APP>:manager:");

/**
 * Database Redis (0–15)
 */
define("REDIS_DATABASE", 1);

/**
 * Habilita ou desabilita o uso do Redis
 */
define("REDIS_ENABLED", true);

/**
 * TTL padrão para cache (segundos)
 */
define("REDIS_DEFAULT_TTL", 3600);

// ============================================================================
// CONFIGURAÇÕES DO KAFKA
// ============================================================================

/**
 * Host do broker Kafka
 */
define("KAFKA_HOST", "kafka_broker");

/**
 * Porta do Kafka
 */
define("KAFKA_PORT", "9092");

/**
 * Tópico Kafka para envio de e-mails
 */
define("KAFKA_TOPIC_EMAIL", "<NOME_APP>_manager_emails");

/**
 * Grupo de consumidores Kafka
 */
define("KAFKA_CONSUMER_GROUP", "<NOME_APP>-email-worker-group");

// ============================================================================
// CONFIGURAÇÕES DE EMAIL (SMTP)
// ============================================================================

/**
 * Identidade do remetente
 */
define("mail_from_name", "<REMETENTE>");
define("mail_from_mail", "<EMAIL_REMETENTE>");

/**
 * Servidor SMTP
 */
define("mail_from_host", "<HOST_SMTP>");
define("mail_from_port", "<PORTA_SMTP>");
define("mail_from_user", "<USUARIO_SMTP>");
define("mail_from_pwd", "<SENHA_SMTP>");

// ============================================================================
// CONFIGURAÇÕES DE CAMINHOS E URLs
// ============================================================================

/**
 * Chave base da aplicação (sessões)
 */
define("cAppKey", "<NOME_APP>_manager_session");

/**
 * Título da aplicação
 */
define("cTitle", "<TITULO_DA_APLICACAO>");

/**
 * Caminho raiz relativo
 */
define("cAppRoot", "/");

/**
 * Caminho físico da raiz do projeto
 */
define("cRootServer", sprintf("%s%s", $_SERVER["DOCUMENT_ROOT"], constant("cAppRoot")));

/**
 * Caminho físico da pasta app
 */
define("cRootServer_APP", sprintf("%s%s", $_SERVER["DOCUMENT_ROOT"], constant("cAppRoot") . "../app"));

/**
 * URL base da aplicação
 */
define("cFrontend", sprintf("http://%s%s", $_SERVER["HTTP_HOST"], constant("cAppRoot")));

/**
 * URL base dos assets
 */
define("cAssets", sprintf("%s%s", constant("cFrontend"), "assets/"));

// ============================================================================
// CONFIGURAÇÕES DE SESSÃO
// ============================================================================

/**
 * Tempo de vida da sessão (segundos)
 */
define("SESSION_LIFETIME", 7200);

/**
 * Usar Redis como handler de sessão
 */
define("SESSION_USE_REDIS", false);

// ============================================================================
// CONFIGURAÇÕES DE UPLOAD
// ============================================================================

/**
 * Diretório físico de upload
 */
define("UPLOAD_DIR", "/var/www/<NOME_APP>/manager/public_html/assets/upload/");

/**
 * Tamanho máximo de upload (MB)
 */
define("UPLOAD_MAX_SIZE", 10);

/**
 * Tipos de arquivos permitidos
 */
define("UPLOAD_ALLOWED_TYPES", "jpg,jpeg,png,gif,pdf,doc,docx,xls,xlsx");

// ============================================================================
// CONFIGURAÇÕES DE LOG
// ============================================================================

/**
 * Diretório de logs
 */
define("LOG_DIR", "/var/log/<NOME_APP>/");

/**
 * Nível de log
 */
define("LOG_LEVEL", "debug");

// ============================================================================
// INICIALIZAÇÃO OPCIONAL DO REDIS
// ============================================================================

/**
 * Inicializa uma instância global do Redis
 * Disponível via $GLOBALS['redis']
 */
if (REDIS_ENABLED && class_exists("RedisCache")) {
    try {
        $GLOBALS["redis"] = RedisCache::getInstance();

        if (!$GLOBALS["redis"]->isConnected()) {
            error_log("Redis não está conectado. Usando apenas MySQL.");
        }
    } catch (Exception $e) {
        error_log("Erro ao inicializar Redis: " . $e->getMessage());
        $GLOBALS["redis"] = null;
    }
}

// ============================================================================
// FIM DAS CONFIGURAÇÕES
// ============================================================================